<h1>后台管理系统</h1> <div> <p>​ 一个基于 Spring Boot 2.4.6 、spring-cloud-alibaba 2020.0.RC1、spring-cloud 2020.0.3、java jdk11、 mybatis-plus 3.4.3.3、 JWT、Spring Security 2.2.10.RELEASE、mysql 5.7、Redis、Vue的前后端分离的后台管理系统</p> <h2><a id="_7"></a>简介</h2> <ul> <li>使用最新技术栈，社区资源丰富。</li> <li>权限控制采用 RBAC 思想</li> <li>高效率开发，代码生成器可一键生成前后端代码</li> <li>支持数据字典，可方便地对一些状态进行管理</li> <li>支持接口限流，避免恶意请求导致服务层压力过大</li> <li>支持接口级别的功能权限与数据权限，可自定义操作</li> <li>自定义权限注解与匿名接口注解，可快速对接口拦截与放行</li> <li>对一些常用地前端组件封装：表格数据请求、数据字典等</li> <li>前后端统一异常拦截处理，统一输出异常，避免繁琐的判断</li> <li>支持在线用户管理与服务器性能监控，支持限制单用户登录</li> <li>支持运维管理，可方便地对远程服务器的应用进行部署与管理</li> </ul> <h3><a id="_21"></a>系统功能</h3> <ul> <li>用户管理：提供用户的相关配置，新增用户后，默认密码为123456</li> <li>角色管理：对权限与菜单进行分配，可根据部门设置角色的数据权限</li> <li>菜单管理：已实现菜单动态路由，后端可配置化，支持多级菜单</li> <li>部门管理：可配置系统组织架构，树形表格展示</li> <li>岗位管理：配置各个部门的职位</li> <li>字典管理：可维护常用一些固定的数据，如：状态，性别等</li> <li>系统日志：记录用户操作日志与异常日志，方便开发人员定位排错</li> <li>SQL监控：采用druid 监控数据库访问性能，默认用户名admin，密码123456</li> <li>定时任务：整合Quartz做定时任务，加入任务日志，任务运行情况一目了然</li> <li>代码生成：高灵活度生成前后端代码，减少大量重复的工作任务</li> <li>邮件工具：配合富文本，发送html格式的邮件</li> <li>支付宝支付：整合了支付宝支付并且提供了测试账号，可自行测试</li> <li>服务监控：监控服务器的负载情况</li> <li>运维管理：一键部署你的应用</li> </ul> <h3><a id="_38"></a>项目结构</h3> <p>项目采用按功能分模块的开发方式，结构如下</p> <ul> <li><code>gxlyedu-common</code> 为系统的公共模块</li> <li><code>gxlyedu-common-&gt;gxlyedu-common-core</code> 为系统的公共模块，各种工具类，公共配置存在该模块</li> <li><code>gxlyedu-common-&gt;gxlyedu-common-log</code> 为系统的公共模块，公共日志模块</li> <li><code>gxlyedu-common-&gt;gxlyedu-common-security</code> 为系统的公共模块，权限校验模块</li> <li><code>gxlyedu-api</code> 为系统的远程接口调用（openFeign）</li> <li><code>gxlyedu-gateway</code> 微服务网关，所有流量经过网关，由网关分发到具体微服务</li> <li><code>gxlyedu-auth</code> 为系统的权限（Security）模块，包含登录验证，验证码…</li> <li><code>gxlyedu-server</code> 为系统微服务服务模块 里面存放了核心服务功能</li> <li><code>gxlyedu-server-&gt;gxlyedu-system-core</code> 系统的最核心的模块整个后台项目的整体权限架构</li> <li><code>gxlyedu-server-&gt;gxlyedu-school</code> 为系统的学校模块，包含对学校专业，学生，老师的操作</li> <li><code>gxlyedu-server-&gt;gxlyedu-mnt</code> 为系统的运维</li> <li><code>gxlyedu-logging</code> 为系统的日志模块，其他模块如果需要记录日志需要引入该模块</li> <li><code>gxlyedu-tools</code> 为第三方工具模块，包含：图床、邮件、云存储、本地存储、支付宝</li> <li><code>gxlyedu-generator</code> 为系统的代码生成模块，代码生成的模板在 system 模块中</li> </ul> <h3><a id="_57"></a>具体微服务对应端口范围</h3> <pre><code class="lang-">GatewayApplication :8081 - 9000 AuthApplication :11000 - 11999 MntApplication :12000 - 12999 QuartzApplication :13000 - 13999 SystemCoreApplication :14000 - 14999 ToolsApplication :15000 - 15999 LogApplication :16000 - 16999 GenratorApplication :17000 - 17999 SchoolApplication:18000 - 18999 </code></pre> <h3><a id="_71"></a>目录对应作用</h3> <pre><code class="lang-tex">gxlyedu-auth： config ： JwtAuthenticationFilter LoginCode-登录验证码配置信息 LoginCodeEnum-验证码配置枚举 LoginProperties-配置文件读取 SecurityConfig-Security认证框架配置信息，配置有密码的加密方式，放行拦截规则等 controller： AuthorizationController-登录、退出、用户信息、验证码 OnlineController- security： JwtAccessDeniedHandler-拒绝访问处理程序 JwtAuthenticationEntryPoint-认证入口点 service： UserDetailsServiceImpl-继承UserDetailsService接口以实现接管Security默认校验功能，先读取redis如没有在查数据库，查询到数据后存入redis中 gxlyedu-common： gxlyedu-common-core： annotation：接口 anonymous：不需要经过权限校验的请求-匿名请求 config：配置信息 ConfigurerAdapter-全局跨域处理、上传文件存储读取位置、消息转换器 FileProperties-判断当前部署的电脑系统 MybatisPlusConfig-mybatis配置信息 MybatisPlusFillHandler-mybatis自动更新处理器 RedisConfig-Redis配置信息、序列化器 constant：常量 enums-邮箱、权限、菜单类型、请求方式枚举 ServiceNameConstants-微服务名 domain：公共实体类 exception：异常信息 ApiError-异常返回格式 GlobalExceptionHandler-全局异常处理 BadRequestException-统一异常处理 EntityExistException-实体存在异常 EntityNotFoundException-实体未找到异常 FeignClientErrorDecoder-远程调用微服务异常 InnerAuthException-内部认证异常 ServiceException-服务内部异常 feign：feign 请求拦截器 utils：全局工具类 bean拷贝、时间转换、加解密、File工具类，扩展 hutool 工具包、获取IP、分页工具、Redis、Rsa 工具类，公钥私钥生成，加解密、SecurityUtils、SpringContextHolder、验证工具、翻译工具类 gxlyedu-common-log：LogAspect使用切面方法，以注解的形式保存日志 gxlyedu-common-security： InnerAuth-内部认证注解，配置此注解方法只能有内部程序访问 InnerAuthAspect-内部认证注解、调用验证处理 config： PermissionConfig-自定义权限校验 SecurityProperties-Jwt参数配置 interceptor：全局拦截请求 gxlyedu-gateway: config:网关配置信息 filter：网关过滤器 GlobalLogFilter-所有请求经过的第一个网关过滤器，用户记录用户信息，记录请求所需时间 RequestFilter-所有请求经过的第二个网关过滤器，请求过滤 AuthFilter-所有请求经过的最后一个网关过滤器，认证过滤、查看是否在过滤白名单上，或者是否携带token gxlyedu-generator：代码生成器 gxlyedu-logging：日志模块，提供服务供用户、程序添加读取删除更新日志 gxlyedu-tools：工具模块，支付服务、邮件服务、本地存储服务、oss存储服务 gxlyedu-api : 所有微服务所需的openFeign调用接口 gxlyedu-server：服务模块 gxlyedu-mnt：运维模块 gxlyedu-quartz：定时模块 gxlyedu-school：学校模块 gxlyedu-system-core：系统模块 </code></pre> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCiWlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fTOJTL8yeMeee757fmeJbqKQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDzXGVgN3FptUaUSlvq9Pa3iZ1sgAqJyyAFqkipd9dqiwHF3P65YycLWc6sqGrvoEoIp6DOFaX5h6dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMiAGarf3BAuuLI5oGlULyNfyBHYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH566fZSDHvQZcih5c5UHtpy67JUqGppM0sh0Nc1dW6N1W5Yoqat8TUVnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4domzE8nEpvXUMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQCK8gF5dnh6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3tHUC138tSdvqFveMUTwAUxSUFI1QekR1bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlzRx17srQ57UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGLTiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVXIvx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRuvSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZB2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZPwbUCr5DPr1J92JNHr9aOlF3iI5O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7O5ApbkYwzpfaUVu32Pi98defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2KejgAAAABJRU5ErkJggg_164"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==" alt="img" />快速开始</h3> <p>使用该项目前，你需要检查你本地的开发环境，避免出现问题!</p> <h4><a id="_168"></a>所需环境</h4> <pre><div class="hljs"><code class="lang-text">1、JDK：11 2、Redis 3.0+ 3、Maven 3.0+ 4、MYSQL 5.7.0 5、Node v10+ (最好使用 12，高版本可能会有问题) </code></div></pre> <p>注意</p> <p>前端安装完 node 后，最好设置下淘宝的镜像源，不建议使用 cnpm（可能会出现奇怪的问题）</p> <pre><div class="hljs"><code class="lang-text">npm config set registry https://registry.npm.taobao.org 配置后可通过下面方式来验证是否成功 npm config get registry 在 ~/.npmrc 加入下面内容，可以避免安装 node-sass 失败 sass_binary_site=https://npm.taobao.org/mirrors/node-sass/ .npmrc 文件位于 win：C:\Users\[你的账户名称]\.npmrc linux：直接使用 vi ~/.npmrc </code></div></pre> <h4><a id="_195"></a>开发准备</h4> <p>提示</p> <p>在使用该系统前，你还需要做如下准备</p> <ol> <li>给 <a href="https://blog.csdn.net/wochunyang/article/details/81736354" target="_blank">idea (opens new window)</a>安装 lombok 插件，我们用它可以省略get，set 方法，可以使代码更简洁， 具体查看 <a href="https://www.ydyno.com/archives/1147.html" target="_blank">lombok教程(opens new window)</a></li> <li>了解MapStruct，项目用到了他映射实体，如果你不熟悉可以查看：<a href="https://www.jianshu.com/p/3f20ca1a93b0" target="_blank">熟悉MapStruct(opens new window)</a></li> <li>你需要有 Spring boot 的基础，推荐教程 <a href="https://github.com/ityouknow/spring-boot-examples" target="_blank">Spring Boot 2.0 学习(opens new window)</a></li> <li>你还需要有 <a href="https://cn.vuejs.org/v2/guide/" target="_blank">Vue (opens new window)</a>的基础，推荐入门视频教程 <a href="https://study.163.com/course/courseMain.htm?courseId=1004711010" target="_blank">网易云课堂(opens new window)</a></li> </ol> <h4><a id="_206"></a>运行项目</h4> <p>注意</p> <p>因为本项目是前后端分离的，所以需要前后端都启动好，才能进行访问</p> <h4><a id="Idea_212"></a>后端运行[Idea]</h4> <p>打开Idea，直接导入Git项目</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609184434.jpg" alt="img" /></p> <p>输入我们的 Git 地址</p> <p>打开数据库，创建一个新库 <code>eladmin</code>，导入sql文件夹中的初始化脚本库脚本 <code>eladmin.sql</code></p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609184722.jpg" alt="img" /></p> <p>修改配置，如果你的数据库密码不是 123456，那么需要在 dev.yml 配置文件中做相应的修改</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609185014.jpg" alt="img" /></p> <p>运行项目：找到 eladmin-system 模块中的 AppRun，点击启动按钮启动程序</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200605112835.jpg" alt="img" /></p> <h4><a id="Eclipse_232"></a>后端运行[Eclipse]</h4> <p>首先克隆项目到本地，Mac 使用终端、Windows 使用 Cmd，定位到工作的目录</p> <pre><div class="hljs"><code class="lang-text">git clone https://gitee.com/elunez/eladmin.git </code></div></pre> <p>1</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609185424.jpg" alt="img" /></p> <p>打开Eclipse，工作空间设置为该目录</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609185609.jpg" alt="img" /></p> <p>导入我们的的项目 File -&gt; Import</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609185730.jpg" alt="img" /></p> <p>选择 Maven ，然后 Next</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609185818.jpg" alt="img" /></p> <p>选择项目的目录，然后 Finish</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609185940.jpg" alt="img" /></p> <p>如果项目一片红色，那么需要你给 Eclipse <a href="https://www.baidu.com/s?ie=utf-8&amp;wd=eclipse%E5%AE%89%E8%A3%85lombok%E6%8F%92%E4%BB%B6" target="_blank">安装 Lombok 插件 (opens new window)</a>，正常的导入后如下</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609190325.jpg" alt="img" /></p> <p>解决 Lombok 的问题后，进入 eladmin-system 模块中的 AppRun，点击启动按钮启动程序</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609190602.jpg" alt="img" /></p> <p>这时会有一个新的问题，那就是 mapstruct 的实现类不会自动生成，报错如下</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609190817.jpg" alt="img" /></p> <p>解决办法就是给 Eclipse 装上 m2e-apt 插件，<a href="https://mapstruct.org/documentation/ide-support/" target="_blank">官方介绍(opens new window)</a></p> <p>点击 help --&gt; install new software --&gt; add，在location里面输入地址：</p> <pre><div class="hljs"><code class="lang-text">http://download.eclipse.org/technology/m2e/releases </code></div></pre> <p>1</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609191851.jpg" alt="img" /></p> <p>然后在项目根目录的 pom.xml 中的 &lt;properties&gt; 节点中加入，然后保存</p> <pre><div class="hljs"><code class="lang-text">&lt;m2e.apt.activation&gt;jdt_apt&lt;/m2e.apt.activation&gt; </code></div></pre> <p>1</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609192055.jpg" alt="img" /></p> <p>导入数据库，修改数据库配置，这个步骤参考上面 Idea 教程的步骤</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609192230.jpg" alt="img" /></p> <p>点击启动按钮旁边的小按钮，然后选择 <code>Maven Install</code> 生成 mapstruct 的实现类</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609192922.jpg" alt="img" /></p> <p>查看 target -&gt; generated-sources 目录是否生成了 mapstruct 的实现类</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609193210.jpg" alt="img" /></p> <p>这个时候启动项目，就不会报错了，至此教程结束</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609193456.jpg" alt="img" /></p> <p>Eclipse 初次使用，因此此教程仅供参考，如果有更好的方案，可以编辑此页面，提个 Pr ！</p> <h4><a id="WebStorm_312"></a>前端运行[WebStorm]</h4> <p>首先克隆项目到本地，Mac 使用终端、Windows 使用 Cmd，定位到工作的目录</p> <pre><div class="hljs"><code class="lang-text">git clone https://gitee.com/elunez/eladmin-web.git </code></div></pre> <p>1</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609194318.jpg" alt="img" /></p> <p>打开 WebStorm，导入我们的项目</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609194432.jpg" alt="img" /></p> <p>这个时候 WebStorm 会在右下角提示我们安装依赖</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609194535.jpg" alt="img" /></p> <p>也可以手动在 Terminal 中输入 <code>npm install</code> 进行安装</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609194723.jpg" alt="img" /></p> <p>依赖安装完成后，打开 package.json 找到 dev 旁边的启动按钮</p> <p><img src="https://eladmin.vip/images/2020/06/25/20200609194958.jpg" alt="img" /></p> <p>启动完后打开 <a href="localhost:8013" target="_blank">localhost:8013</a> 即可</p> <h4><a id="_342"></a>前端运行常见问题</h4> <p><em>1、依赖安装失败</em></p> <p>可通过配置淘宝的镜像源解决</p> <pre><div class="hljs"><code class="lang-text">npm config set registry https://registry.npm.taobao.org 配置后可通过下面方式来验证是否成功 npm config get registry 在 ~/.npmrc 加入下面内容，可以避免安装 node-sass 失败 sass_binary_site=https://npm.taobao.org/mirrors/node-sass/ .npmrc 文件位于 win：C:\Users\[你的账户名称]\.npmrc linux：直接使用 vi ~/.npmrc </code></div></pre> <p><em>2、linux 系统在安装依赖的时候会出现 node-sass 无法安装的问题</em></p> <p>解决方案：</p> <pre><div class="hljs"><code class="lang-text">1. 单独安装：npm install --unsafe-perm node-sass 2. 直接使用：npm install --unsafe-perm </code></div></pre> <h2><a id="_372"></a><strong>后端手册</strong></h2> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5DxFJaTYItIuK2Kr3BJNwkxBj05sQY3b3nM6cs2dv9t7NTvQJwsndk5MPNzJkzewGerPpAmyON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdWi781o1VVlm410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi7O9iXFT6MswI0DmmpkSaJ0qLxFIm3i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUVMnSawNNAUqpT3ClJWg5I3BLTcGWDXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSxuRQixfmq7rK0wYD8w8E905bnPDfwoWsrfv93NWNZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGWZEl945dTP34wlR2FZVQWU1q0Cw8Tr7phgLLNL0FPxxQ35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UHk0lfyrsBKdPVvAriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1uKBbyVPGkN3ZAeC6hr0x7Nr38N5EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOBYHi6QTrChDIWDBRi5U5fZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwIhnmcAZ91isYMJIaCUCx9W098LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7kOjIGxeNEkomyLVta0xxnHZhjBc4YZAFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j14dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6JDjq6p3OxyO2cB4Car7vo3GXgfAkj23x9ID1TeoamoSXcbvSf2PX7Vc8DdCmE1vN9di32P95YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7jctrJpsP4COhDIl0La2FS45mlocBaXY5QnGZysIBYoeSsl5qQzrSjcgNrfuEzlWBfwAEjrZyWUvpAAAAABJRU5ErkJggg_374"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==" alt="img" />新增模块</h3> <h4><a id="_376"></a>新建模块</h4> <p>这里演示使用 Idea 创建一个新的子模块</p> <p>选择 File -&gt; New -&gt; Module</p> <p><img src="script%5Cimg%5C20200606132523.jpg" alt="img" /></p> <p>选择 Maven -&gt; Next</p> <p><img src="script%5Cimg%5C20200606132934.jpg" alt="img" /></p> <p>选择父模块 -&gt; Finish</p> <p><img src="script%5Cimg%5C20200606133131.jpg" alt="img" /></p> <p>回到项目，在新模块中创建包</p> <p><img src="script%5Cimg%5C20200606134124.jpg" alt="img" /></p> <p>给新模块起一个名字</p> <p><img src="script%5Cimg%5C20200606134512.jpg" alt="img" /></p> <p>最后在 System 模块的 pom.xml 的 dependencies 节点加入创建的子模块</p> <p><img src="script%5Cimg%5C20200606134610.jpg" alt="img" /></p> <blockquote> <p>注意:此处还需要添加tool模块的依赖，才能在启动时扫描到该模块swagger才能加载此模块的借口</p> </blockquote> <pre><div class="hljs"><code class="lang-xml"> <span class="hljs-comment">&lt;!-- tools 模块包含了 common 和 logging 模块--&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>me.zhengjie<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>eladmin-tools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> </code></div></pre> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCiWlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fTOJTL8yeMeee757fmeJbqKQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDzXGVgN3FptUaUSlvq9Pa3iZ1sgAqJyyAFqkipd9dqiwHF3P65YycLWc6sqGrvoEoIp6DOFaX5h6dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMiAGarf3BAuuLI5oGlULyNfyBHYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH566fZSDHvQZcih5c5UHtpy67JUqGppM0sh0Nc1dW6N1W5Yoqat8TUVnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4domzE8nEpvXUMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQCK8gF5dnh6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3tHUC138tSdvqFveMUTwAUxSUFI1QekR1bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlzRx17srQ57UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGLTiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVXIvx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRuvSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZB2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZPwbUCr5DPr1J92JNHr9aOlF3iI5O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7O5ApbkYwzpfaUVu32Pi98defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2KejgAAAABJRU5ErkJggg_416"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==" alt="img" />权限控制</h3> <h4><a id="_418"></a>权限控制</h4> <p>本系统权限控制采用 <code>RBAC</code> 思想。简单地说，一个用户拥有若干角色，每一个角色拥有若干个菜单，菜单中存在菜单权限与按钮权限， 这样，就构造成“用户-角色-菜单” 的授权模型。在这种模型中，用户与角色、角色与菜单之间构成了多对多的关系，如下图</p> <p><img src="script%5Cimg%5C20200605134807.jpg" alt="img" /></p> <p>安全框架使用的是 <code>Spring Security + Jwt Token</code>， 访问后端接口需在请求头中携带<code>token</code>进行访问，请求头格式如下：</p> <ul> <li> <pre><div class="hljs"><code class="lang-text"># Authorization: Bearer 登录时返回的token </code></div></pre> </li> <li> <pre><div class="hljs"><code class="lang-text">Authorization: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTU1ODk2NzY0OSwiaWF0IjoxNTU4OTQ2MDQ5fQ.jsJvqHa1tKbJazG0p9kq5J2tT7zAk5B6N_CspdOAQLWgEICStkMmvLE-qapFTtWnnDUPAjqmsmtPFSWYaH5LtA </code></div></pre> </li> </ul> <h4><a id="_436"></a>数据交互</h4> <p>用户登录 -&gt; 后端验证登录返回 <code>token</code> -&gt; 前端带上<code>token</code>请求后端数据 -&gt; 后端返回数据， 数据交互流程如下：</p> <p><img src="script%5Cimg%5C20200605142356.jpg" alt="img" /></p> <h4><a id="_442"></a>权限注解</h4> <p><code>Spring Security</code> 提供了<code>Spring EL</code>表达式，允许我们在定义接口访问的方法上面添加注解，来控制访问权限，常用的 <code>EL</code>如下</p> <table> <thead> <tr> <th>表达式</th> <th>描述</th> </tr> </thead> <tbody> <tr> <td>hasRole([role])</td> <td>当前用户是否拥有指定角色。</td> </tr> <tr> <td>hasAnyRole([role1,role2])</td> <td>多个角色是一个以逗号进行分隔的字符串。如果当前用户拥有指定角色中的任意一个则返回true。</td> </tr> </tbody> </table> <p>下面的接口表示用户拥有 <code>admin</code>、<code>menu:edit</code> 权限中的任意一个就能能访问<code>update</code>方法， 如果方法不加<code>@preAuthorize</code>注解，意味着所有用户都需要带上有效的 <code>token</code> 后能访问 <code>update</code> 方法</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@Log(description = &quot;修改菜单&quot;)</span> <span class="hljs-meta">@PutMapping(value = &quot;/menus&quot;)</span> <span class="hljs-meta">@PreAuthorize(&quot;hasAnyRole(&#x27;admin&#x27;,&#x27;menu:edit&#x27;)&quot;)</span> <span class="hljs-keyword">public</span> ResponseEntity <span class="hljs-title function_">update</span><span class="hljs-params">(<span class="hljs-meta">@Validated</span> <span class="hljs-meta">@RequestBody</span> Menu resources)</span>{ <span class="hljs-comment">// 略</span> } </code></div></pre> <p>由于每个接口都需要给超级管理员放行，而使用 <code>hasAnyRole('admin','user:list')</code> 每次都需要重复的添加 admin 权限，因此在新版本 (2.3) 中加入了自定义权限验证方式，在验证的时候默认给拥有admin权限的用户放行。</p> <p><strong>源码:</strong></p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-comment">// eladmin-common -&gt; me.zhengjie.config.ElPermissionConfig</span> <span class="hljs-meta">@Service(value = &quot;el&quot;)</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ElPermissionConfig</span> { <span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">check</span><span class="hljs-params">(String ...permissions)</span>{ <span class="hljs-comment">// 获取当前用户的所有权限</span> List&lt;String&gt; elPermissions = SecurityUtils.getCurrentUser().getAuthorities().stream().map(GrantedAuthority::getAuthority).collect(Collectors.toList()); <span class="hljs-comment">// 判断当前用户的所有权限是否包含接口上定义的权限</span> <span class="hljs-keyword">return</span> elPermissions.contains(<span class="hljs-string">&quot;admin&quot;</span>) || Arrays.stream(permissions).anyMatch(elPermissions::contains); } } </code></div></pre> <p><strong>使用方式：</strong></p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@PreAuthorize(&quot;@el.check(&#x27;user:list&#x27;,&#x27;user:add&#x27;)&quot;)</span> </code></div></pre> <h4><a id="_489"></a>接口放行</h4> <p>在我们使用的时候，有些接口是不需要验证权限的，这个时候就需要我们给接口放行，使用方式如下</p> <p><strong>1、使用注解方式</strong></p> <p>只需要在Controller的方法上加入该注解即可</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@AnonymousAccess</span> </code></div></pre> <p><strong>2、修改配置文件方式</strong></p> <p><strong>eladmin-system -&gt; modules -&gt; security -&gt; config -&gt; SecurityConfig</strong></p> <p>提示</p> <p>使用 <code>permitAll()</code> 方法所有人都能访问，包括带上 <code>token</code> 访问</p> <p>使用 <code>anonymous()</code> 所有人都能访问，但是带上 <code>token</code> 访问后会报错</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-comment">// 关键代码，部分略</span> <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity httpSecurity)</span> <span class="hljs-keyword">throws</span> Exception { httpSecurity <span class="hljs-comment">// 支付宝回调</span> .antMatchers(<span class="hljs-string">&quot;/api/aliPay/return&quot;</span>).anonymous() <span class="hljs-comment">// 所有请求都需要认证</span> .anyRequest().authenticated(); httpSecurity .addFilterBefore(authenticationTokenFilter, UsernamePasswordAuthenticationFilter.class); } </code></div></pre> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5DxFJaTYItIuK2Kr3BJNwkxBj05sQY3b3nM6cs2dv9t7NTvQJwsndk5MPNzJkzewGerPpAmyON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdWi781o1VVlm410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi7O9iXFT6MswI0DmmpkSaJ0qLxFIm3i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUVMnSawNNAUqpT3ClJWg5I3BLTcGWDXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSxuRQixfmq7rK0wYD8w8E905bnPDfwoWsrfv93NWNZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGWZEl945dTP34wlR2FZVQWU1q0Cw8Tr7phgLLNL0FPxxQ35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UHk0lfyrsBKdPVvAriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1uKBbyVPGkN3ZAeC6hr0x7Nr38N5EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOBYHi6QTrChDIWDBRi5U5fZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwIhnmcAZ91isYMJIaCUCx9W098LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7kOjIGxeNEkomyLVta0xxnHZhjBc4YZAFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j14dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6JDjq6p3OxyO2cB4Car7vo3GXgfAkj23x9ID1TeoamoSXcbvSf2PX7Vc8DdCmE1vN9di32P95YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7jctrJpsP4COhDIl0La2FS45mlocBaXY5QnGZysIBYoeSsl5qQzrSjcgNrfuEzlWBfwAEjrZyWUvpAAAAABJRU5ErkJggg_526"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==" alt="img" />通用查询</h3> <h4><a id="_528"></a>通用查询</h4> <p>本项目对 mybatis-plus的查询进行了封装，现可以通过 <code>@Query</code> 注解实现简单的查询与复杂查询</p> <p>简单查询：<code>等于(默认)、大于等于、小于等于、左模糊、右模糊、中模糊、多字段模糊、NOT_EQUAL 、BETWEEN 、NOT_NULL</code>。</p> <p>复杂查询：<code>包含（IN）查询、左连接、右连接等</code></p> <h4><a id="_536"></a>参数说明</h4> <table> <thead> <tr> <th>字段名称</th> <th>字段描述</th> <th>默认值</th> </tr> </thead> <tbody> <tr> <td>propName</td> <td>对象的属性名，如果字段名称与实体字段一致，则可以省略</td> <td>“”</td> </tr> <tr> <td>type</td> <td>查询方式，默认为</td> <td>EQUAL</td> </tr> <tr> <td>blurry</td> <td>多字段模糊查询，值为实体字段名称</td> <td>“”</td> </tr> <tr> <td>joinName</td> <td>关联实体的名称</td> <td>“”</td> </tr> <tr> <td>join</td> <td>连接查询方式，左连接或者右连接</td> <td>LEFT</td> </tr> </tbody> </table> <h4><a id="_546"></a>使用方式</h4> <p><strong>1、创建一个查询类 <code>QueryCriteria</code></strong></p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@Data</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryCriteria</span> { <span class="hljs-comment">// 等于</span> <span class="hljs-meta">@Query</span> <span class="hljs-keyword">private</span> String a; <span class="hljs-comment">// 左模糊</span> <span class="hljs-meta">@Query(type = Query.Type.LEFT_LIKE)</span> <span class="hljs-keyword">private</span> String b; <span class="hljs-comment">// 右模糊</span> <span class="hljs-meta">@Query(type = Query.Type.RIGHT_LIKE)</span> <span class="hljs-keyword">private</span> String c; <span class="hljs-comment">// 大于等于</span> <span class="hljs-meta">@Query(type = Query.Type.GREATER_THAN, propName = &quot;createTime&quot;)</span> <span class="hljs-keyword">private</span> Timestamp startTime; <span class="hljs-comment">// 小于等于</span> <span class="hljs-meta">@Query(type = Query.Type.LESS_THAN, propName = &quot;createTime&quot;)</span> <span class="hljs-keyword">private</span> Timestamp endTime; <span class="hljs-comment">// BETWEEN</span> <span class="hljs-meta">@Query(type = Query.Type.BETWEEN)</span> <span class="hljs-keyword">private</span> List&lt;Timestamp&gt; startTime; <span class="hljs-comment">// 多字段模糊查询，blurry 为字段名称</span> <span class="hljs-meta">@Query(blurry = &quot;a,b,c&quot;)</span> <span class="hljs-keyword">private</span> String blurry; <span class="hljs-comment">// IN 查询</span> <span class="hljs-meta">@Query(type = Query.Type.IN)</span> <span class="hljs-keyword">private</span> List&lt;String&gt; d; <span class="hljs-comment">// 左关联查询，left Join ， joinName为关联实体名称 , propName为关联实体 字段</span> <span class="hljs-meta">@Query(joinName = &quot;&quot;, propName=&quot;&quot;)</span> <span class="hljs-keyword">private</span> String e; <span class="hljs-comment">// 右关联查询，right Join ， joinName为关联实体名称 , propName为关联实体 字段</span> <span class="hljs-meta">@Query(joinName = &quot;&quot;, propName=&quot;&quot;, join = Query.Join.RIGHT)</span> <span class="hljs-keyword">private</span> String f; <span class="hljs-comment">// NOT_EQUAL 不等于</span> <span class="hljs-meta">@Query(type = Query.Type.NOT_EQUAL)</span> <span class="hljs-keyword">private</span> String g; <span class="hljs-comment">// NOT_NULL 不为空</span> <span class="hljs-meta">@Query(type = Query.Type.NOT_NULL)</span> <span class="hljs-keyword">private</span> String g; } </code></div></pre> <p><strong>2、在控制器中使用</strong></p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-comment">// Pageable 分页查询</span> <span class="hljs-keyword">public</span> ResponseEntity <span class="hljs-title function_">query</span><span class="hljs-params">(QueryCriteria criteria, Pageable pageable)</span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>(service.queryAll(criteria,pageable), HttpStatus.OK); } </code></div></pre> <p><strong>3、Service 中查询</strong></p> <pre><div class="hljs"><code class="lang-text">@Override public Object queryAll(QueryCriteria criteria, Pageable pageable){ Page&lt;实体&gt; page = repository.findAll(((root, criteriaQuery, cb) -&gt; QueryHelp.getPredicate(root, criteria, cb)),pageable); return page; } </code></div></pre> <p>提示</p> <p>如果需要添加一个字段查询，只需要在查询类 <code>QueryCriteria</code> 中添加就可以了，可节省大量时间。</p> <p>源码可以查看 <code>eladmin-common</code> 模块中的 <code>me.zhengjie.annotation.Query</code> 与 <code>me.zhengjie.utils.QueryHelp</code></p> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCiWlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fTOJTL8yeMeee757fmeJbqKQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDzXGVgN3FptUaUSlvq9Pa3iZ1sgAqJyyAFqkipd9dqiwHF3P65YycLWc6sqGrvoEoIp6DOFaX5h6dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMiAGarf3BAuuLI5oGlULyNfyBHYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH566fZSDHvQZcih5c5UHtpy67JUqGppM0sh0Nc1dW6N1W5Yoqat8TUVnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4domzE8nEpvXUMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQCK8gF5dnh6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3tHUC138tSdvqFveMUTwAUxSUFI1QekR1bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlzRx17srQ57UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGLTiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVXIvx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRuvSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZB2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZPwbUCr5DPr1J92JNHr9aOlF3iI5O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7O5ApbkYwzpfaUVu32Pi98defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2KejgAAAABJRU5ErkJggg_632"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==" alt="img" />系统缓存</h3> <h4><a id="_634"></a>系统缓存</h4> <p>本系统缓存使用的是 <code>Redis</code>，默认使用 <code>Spring</code> 的注解对系统缓存进行操作, 现版本优化了</p> <h4><a id="_638"></a>配置缓存</h4> <p>配置文件位于 <code>eladmin-common</code> 模块中的 <code>me.zhengjie.config.RedisConfig</code></p> <h4><a id="_642"></a>缓存注解</h4> <pre><div class="hljs"><code class="lang-text">@CacheConfig：主要用于配置该类中会用到的一些共用的缓存配置 @Cacheable：主要方法的返回值将被加入缓存。在查询时，会先从缓存中获取，若不存在才再发起对数据库的访问 @CachePut：主要用于数据新增和修改操作 @CacheEvict：配置于函数上，通常用在删除方法上，用来从缓存中移除相应数据 </code></div></pre> <h4><a id="_655"></a>使用建议</h4> <p>缓存的出现加快了数据查询的速度，同时增加了维护成本，建议使用在高频读低频写的数据上。</p> <p>使用不当可能会出现数据不一致的问题，请谨慎使用。</p> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0KKoFeJHfZAED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4UDAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5KJD6t7FkFdEvGUo1g7qJoG3MHImqRIn8nzY1K9UPKKiJmtnUqHVE3Gbuay6vJEN2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6IG5Eru4LHmPJZEQsrvPUbMiA8GWgMK7w7Iez7o2ANfbrjvaOl1tFMshtG3IrZH9hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5iy0UDK35LMxXisn9xQtKnd26gTIHsHeoblKb29fUmN8Y9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybuoeV8zFeYN3xx576Q6RHVmplE4ncQV5v5rzSoyOU7PuEAg8g803PwBJ0CExnojcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPvouCjz0MKUHz1J2E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vtMoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG2DOZIXgCYT8uMGZNe2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErPkFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4P2FGaJh8c7e9qgowQ7cGBo98WsLkuktFqiZabtXuQTuY5ETbR0v7tNSFnvrmu6pjdoan2KjMu8qHmj1EfCO2ZGfEIbIXKUlw8qaX9b2oeSJmFksSeTFn0V3nSypChh4Gjh74ybO9aeZAN2dwciu2MhAAAAAElFTkSuQmCC_661"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC" alt="img" />异常处理</h3> <h4><a id="_663"></a>异常处理</h4> <p>我们开发项目的时候，数据在请求过程中发生错误是非常常见的事情。</p> <p>如：权限不足、数据唯一异常、数据不能为空异常、业务异常等。 这些异常如果不经过处理会对前端开发人员和使用者造成不便，因此我们就需要统一处理他们。</p> <p>源码位于：源码位于：<code>eladmin-common</code> 模块中的 <code>exception</code> 包中</p> <h4><a id="_671"></a>异常封装</h4> <hr /> <h5><a id="_675"></a>异常实体</h5> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@Data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiError</span> { <span class="hljs-keyword">private</span> Integer status; <span class="hljs-meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span> <span class="hljs-keyword">private</span> LocalDateTime timestamp; <span class="hljs-keyword">private</span> String message; <span class="hljs-keyword">private</span> <span class="hljs-title function_">ApiError</span><span class="hljs-params">()</span> { timestamp = LocalDateTime.now(); } <span class="hljs-keyword">public</span> <span class="hljs-title function_">ApiError</span><span class="hljs-params">(Integer status,String message)</span> { <span class="hljs-built_in">this</span>(); <span class="hljs-built_in">this</span>.status = status; <span class="hljs-built_in">this</span>.message = message; } } </code></div></pre> <h5><a id="_698"></a>自定义异常</h5> <p>1、通用异常</p> <p>封装了 <code>BadRequestException</code>，用于处理通用的异常</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@Getter</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BadRequestException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span>{ <span class="hljs-keyword">private</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">status</span> <span class="hljs-operator">=</span> BAD_REQUEST.value(); <span class="hljs-keyword">public</span> <span class="hljs-title function_">BadRequestException</span><span class="hljs-params">(String msg)</span>{ <span class="hljs-built_in">super</span>(msg); } <span class="hljs-keyword">public</span> <span class="hljs-title function_">BadRequestException</span><span class="hljs-params">(HttpStatus status,String msg)</span>{ <span class="hljs-built_in">super</span>(msg); <span class="hljs-built_in">this</span>.status = status.value(); } } </code></div></pre> <p>2、实体相关异常</p> <p>(1) 实体不存在： <code>EntityNotFoundException</code></p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-keyword">import</span> org.springframework.util.StringUtils; <span class="hljs-comment">/** * <span class="hljs-doctag">@author</span> Zheng Jie * <span class="hljs-doctag">@date</span> 2018-11-23 */</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntityNotFoundException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> { <span class="hljs-keyword">public</span> <span class="hljs-title function_">EntityNotFoundException</span><span class="hljs-params">(Class clazz, String field, String val)</span> { <span class="hljs-built_in">super</span>(EntityNotFoundException.generateMessage(clazz.getSimpleName(), field, val)); } <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateMessage</span><span class="hljs-params">(String entity, String field, String val)</span> { <span class="hljs-keyword">return</span> StringUtils.capitalize(entity) + <span class="hljs-string">&quot; with &quot;</span> + field + <span class="hljs-string">&quot; &quot;</span>+ val + <span class="hljs-string">&quot; does not exist&quot;</span>; } } </code></div></pre> <p>(2) 实体已存在：<code>EntityExistException</code></p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-keyword">import</span> org.springframework.util.StringUtils; <span class="hljs-comment">/** * <span class="hljs-doctag">@author</span> Zheng Jie * <span class="hljs-doctag">@date</span> 2018-11-23 */</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntityExistException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> { <span class="hljs-keyword">public</span> <span class="hljs-title function_">EntityExistException</span><span class="hljs-params">(Class clazz, String field, String val)</span> { <span class="hljs-built_in">super</span>(EntityExistException.generateMessage(clazz.getSimpleName(), field, val)); } <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">generateMessage</span><span class="hljs-params">(String entity, String field, String val)</span> { <span class="hljs-keyword">return</span> StringUtils.capitalize(entity) + <span class="hljs-string">&quot; with &quot;</span> + field + <span class="hljs-string">&quot; &quot;</span>+ val + <span class="hljs-string">&quot; existed&quot;</span>; } } </code></div></pre> <p>使用场景，删除用户的时候是根据ID删除的，可判断ID是否存在，抛出异常</p> <p>新增用户的时候用户名是唯一的，可判断用户是否存在，抛出异常</p> <h5><a id="_774"></a>全局异常拦截</h5> <p>使用全局异常处理器 <code>@RestControllerAdvice</code> 处理请求发送的异常</p> <ul> <li>@RestControllerAdvice：默认会扫描指定包中所有@RequestMapping注解</li> <li>@ExceptionHandler：通过@ExceptionHandler的 value 属性可过滤拦截的条件</li> </ul> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@RestControllerAdvice</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> { <span class="hljs-comment">/** * 处理所有不可知的异常 * <span class="hljs-doctag">@param</span> e * <span class="hljs-doctag">@return</span> */</span> <span class="hljs-meta">@ExceptionHandler(Throwable.class)</span> <span class="hljs-keyword">public</span> ResponseEntity <span class="hljs-title function_">handleException</span><span class="hljs-params">(Throwable e)</span>{ <span class="hljs-comment">// 打印堆栈信息</span> log.error(ThrowableUtil.getStackTrace(e)); <span class="hljs-type">ApiError</span> <span class="hljs-variable">apiError</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiError</span>(BAD_REQUEST.value(),e.getMessage()); <span class="hljs-keyword">return</span> buildResponseEntity(apiError); } <span class="hljs-comment">/** * 处理自定义异常 * <span class="hljs-doctag">@param</span> e * <span class="hljs-doctag">@return</span> */</span> <span class="hljs-meta">@ExceptionHandler(value = BadRequestException.class)</span> <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiError&gt; <span class="hljs-title function_">badRequestException</span><span class="hljs-params">(BadRequestException e)</span> { <span class="hljs-comment">// 打印堆栈信息</span> log.error(ThrowableUtil.getStackTrace(e)); <span class="hljs-type">ApiError</span> <span class="hljs-variable">apiError</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiError</span>(e.getStatus(),e.getMessage()); <span class="hljs-keyword">return</span> buildResponseEntity(apiError); } <span class="hljs-comment">/** * 处理 EntityExist * <span class="hljs-doctag">@param</span> e * <span class="hljs-doctag">@return</span> */</span> <span class="hljs-meta">@ExceptionHandler(value = EntityExistException.class)</span> <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiError&gt; <span class="hljs-title function_">entityExistException</span><span class="hljs-params">(EntityExistException e)</span> { <span class="hljs-comment">// 打印堆栈信息</span> log.error(ThrowableUtil.getStackTrace(e)); <span class="hljs-type">ApiError</span> <span class="hljs-variable">apiError</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiError</span>(BAD_REQUEST.value(),e.getMessage()); <span class="hljs-keyword">return</span> buildResponseEntity(apiError); } <span class="hljs-comment">/** * 处理 EntityNotFound * <span class="hljs-doctag">@param</span> e * <span class="hljs-doctag">@return</span> */</span> <span class="hljs-meta">@ExceptionHandler(value = EntityNotFoundException.class)</span> <span class="hljs-keyword">public</span> ResponseEntity&lt;ApiError&gt; <span class="hljs-title function_">entityNotFoundException</span><span class="hljs-params">(EntityNotFoundException e)</span> { <span class="hljs-comment">// 打印堆栈信息</span> log.error(ThrowableUtil.getStackTrace(e)); <span class="hljs-type">ApiError</span> <span class="hljs-variable">apiError</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiError</span>(NOT_FOUND.value(),e.getMessage()); <span class="hljs-keyword">return</span> buildResponseEntity(apiError); } <span class="hljs-comment">/** * 统一返回 * <span class="hljs-doctag">@param</span> apiError * <span class="hljs-doctag">@return</span> */</span> <span class="hljs-keyword">private</span> ResponseEntity&lt;ApiError&gt; <span class="hljs-title function_">buildResponseEntity</span><span class="hljs-params">(ApiError apiError)</span> { <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>(apiError, HttpStatus.valueOf(apiError.getStatus())); } } </code></div></pre> <h4><a id="_847"></a>具体使用</h4> <pre><div class="hljs"><code class="lang-java"><span class="hljs-comment">// 通用异常</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadRequestException</span>(<span class="hljs-string">&quot;发生了异常&quot;</span>); <span class="hljs-comment">// 通用异常，使用自定义状态码</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadRequestException</span>(HttpStatus.OK, <span class="hljs-string">&quot;发送了异常&quot;</span>); <span class="hljs-comment">// 实体存在异常</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EntityExistException</span>(User.class, <span class="hljs-string">&quot;email&quot;</span>, <span class="hljs-string">&quot;elunez@qq.com&quot;</span>); <span class="hljs-comment">// 实体不存在异常</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EntityNotFoundException</span>(User.class, <span class="hljs-string">&quot;userName&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); </code></div></pre> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5DxFJaTYItIuK2Kr3BJNwkxBj05sQY3b3nM6cs2dv9t7NTvQJwsndk5MPNzJkzewGerPpAmyON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdWi781o1VVlm410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi7O9iXFT6MswI0DmmpkSaJ0qLxFIm3i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUVMnSawNNAUqpT3ClJWg5I3BLTcGWDXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSxuRQixfmq7rK0wYD8w8E905bnPDfwoWsrfv93NWNZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGWZEl945dTP34wlR2FZVQWU1q0Cw8Tr7phgLLNL0FPxxQ35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UHk0lfyrsBKdPVvAriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1uKBbyVPGkN3ZAeC6hr0x7Nr38N5EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOBYHi6QTrChDIWDBRi5U5fZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwIhnmcAZ91isYMJIaCUCx9W098LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7kOjIGxeNEkomyLVta0xxnHZhjBc4YZAFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j14dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6JDjq6p3OxyO2cB4Car7vo3GXgfAkj23x9ID1TeoamoSXcbvSf2PX7Vc8DdCmE1vN9di32P95YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7jctrJpsP4COhDIl0La2FS45mlocBaXY5QnGZysIBYoeSsl5qQzrSjcgNrfuEzlWBfwAEjrZyWUvpAAAAABJRU5ErkJggg_861"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==" alt="img" />系统日志</h3> <h4><a id="_863"></a>系统日志</h4> <p>本系统使用 <code>AOP</code> 方式记录用户操作日志，只需要在 <code>controller</code> 的方法上使用 <code>@Log(&quot;&quot;)</code> 注解，就可以将用户操作记录到数据库，源码可查看 <code>eladmin-logging</code><br /> 模块具体使用如下：</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@Log(&quot;新增用户&quot;)</span> <span class="hljs-meta">@PostMapping(value = &quot;/users&quot;)</span> <span class="hljs-keyword">public</span> ResponseEntity <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@Validated</span> <span class="hljs-meta">@RequestBody</span> User resources)</span>{ checkLevel(resources); <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseEntity</span>(userService.create(resources),HttpStatus.CREATED); } </code></div></pre> <p>页面上可以看到 <code>操作日志</code>和<code>异常日志</code></p> <h4><a id="_880"></a>操作日志</h4> <p><img src="script%5Cimg%5Cimage.jpg" alt="image.jpg" /></p> <h4><a id="_884"></a>异常日志</h4> <p><img src="script%5Cimg%5Cimagea9d688d59a73612d-168267304039119.jpg" alt="imagea9d688d59a73612d.jpg" /></p> <p>学校模块：</p> <p>学校模块中的schoolService和StudentService都调用了UserService的方法<br /> 所以引用了openfeign的注解功能，抽取处了gxlyed-api模块的service包进行远程调用服务<br /> service包中的RemoteUserService就是Userservice的调用类<br /> 数据权限</p> <h3><a id="_895"></a>数据权限</h3> <p>本系统是基于部门做的一个简单数据权限控制，也就是通过用户角色中的数据权限控制用户能看哪些数据。</p> <p>实现思路就是通过获取角色中关联的部门ID，再通过 IN 查询，达到数据权限控制，前提是被查询的表中需要有 部门ID 的字段。</p> <h3><a id="_901"></a>注解方式</h3> <p>现可通过注解 <code>@DataPermission</code> 进行权限控制</p> <p><strong>源码如下：</strong></p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-comment">/** * &lt;p&gt; * 用于判断是否过滤数据权限 * 1、如果没有用到 <span class="hljs-doctag">@OneToOne</span> 这种关联关系，只需要填写 fieldName [参考：DeptQueryCriteria.class] * 2、如果用到了 <span class="hljs-doctag">@OneToOne</span> ，fieldName 和 joinName 都需要填写，拿UserQueryCriteria.class举例: * 应该是 <span class="hljs-doctag">@DataPermission</span>(joinName = &quot;dept&quot;, fieldName = &quot;id&quot;) * &lt;/p&gt; * <span class="hljs-doctag">@author</span> Zheng Jie * <span class="hljs-doctag">@website</span> https://eladmin.vip * <span class="hljs-doctag">@date</span> 2020-05-07 **/</span> <span class="hljs-meta">@Target(ElementType.TYPE)</span> <span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span> <span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> DataPermission { <span class="hljs-comment">/** * Entity 中的字段名称 */</span> String <span class="hljs-title function_">fieldName</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>; <span class="hljs-comment">/** * Entity 中与部门关联的字段名称 */</span> String <span class="hljs-title function_">joinName</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>; } </code></div></pre> <p>目前系统在 <code>用户管理</code>、<code>部门管理</code> 中加入了数据权限供大家测试，具体查看源码</p> <h3><a id="_941"></a>数据权限</h3> <p>系统提供了三种数据权限控制</p> <ul> <li>全部数据权限 无数据权限限制</li> <li>本级数据权限 限制只能看到本部门数据</li> <li><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5Cimage0f5e3aad914e8118.jpg" alt="image0f5e3aad914e8118" />自定义数据权限 可根据实际需要选择部门控制数据权限</li> </ul> <h3><a id="_951"></a>定时任务</h3> <p>对于简单的定时任务用 <code>Spring</code>的 <code>@Scheduled</code> 注解即可，如需要动态管理定时任务就需要使用到 <code>Quartz</code>。本系统的动态定时任务源码位于 <code>eldamin-system -&gt; modules -&gt; quartz</code>，使用流程如下</p> <h4><a id="_955"></a>任务处理类</h4> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@Slf4j</span> <span class="hljs-meta">@Component</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestTask</span> { <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span>{ log.info(<span class="hljs-string">&quot;执行成功&quot;</span>); } <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run1</span><span class="hljs-params">(String str)</span>{ log.info(<span class="hljs-string">&quot;执行成功，参数为： {}&quot;</span> + str); } } </code></div></pre> <h4><a id="_968"></a>创建定时任务</h4> <p>打开定时任务页面，点击新增按钮创建定时任务，部分参数解释如下：</p> <ul> <li>Bean名称：Spring Bean名称，如： testTask</li> <li>方法名称：对应后台任务方法名称 方法参数：对应后台任务方法名称值，没有可不填</li> <li>cron表达式：可查询官方cron表达式介绍</li> <li>任务负责人与告警邮箱：支持多个邮箱，定时任务执行失败邮箱提醒</li> <li>子任务ID：现支持添加子任务，支持多个子任务，按顺序执行</li> <li>状态：是否启动定时任务</li> </ul> <p>常用cron表达式</p> <pre><code class="lang-cron">0 0 10,14,16 * * ? 每天上午10点，下午2点，4点 0 0/30 9-17 * * ? 朝九晚五工作时间内每半小时 0 0 12 ? * WED 表示每个星期三中午12点 &quot;0 0 12 * * ?&quot; 每天中午12点触发 &quot;0 15 10 ? * *&quot; 每天上午10:15触发 &quot;0 15 10 * * ?&quot; 每天上午10:15触发 &quot;0 15 10 * * ? *&quot; 每天上午10:15触发 &quot;0 15 10 * * ? 2005&quot; 2005年的每天上午10:15触发 &quot;0 * 14 * * ?&quot; 在每天下午2点到下午2:59期间的每1分钟触发 &quot;0 0/5 14 * * ?&quot; 在每天下午2点到下午2:55期间的每5分钟触发 &quot;0 0/5 14,18 * * ?&quot; 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发 &quot;0 0-5 14 * * ?&quot; 在每天下午2点到下午2:05期间的每1分钟触发 &quot;0 10,44 14 ? 3 WED&quot; 每年三月的星期三的下午2:10和2:44触发 &quot;0 15 10 ? * MON-FRI&quot; 周一至周五的上午10:15触发 &quot;0 15 10 15 * ?&quot; 每月15日上午10:15触发 &quot;0 15 10 L * ?&quot; 每月最后一日的上午10:15触发 &quot;0 15 10 ? * 6L&quot; 每月的最后一个星期五上午10:15触发 &quot;0 15 10 ? * 6L 2002-2005&quot; 2002年至2005年的每月的最后一个星期五上午10:15触发 &quot;0 15 10 ? * 63&quot; 每月的第三个星期五上午10:15触发 </code></pre> <h3><a id="_1007"></a>代码生成</h3> <p>本系统提供高灵活度的代码生成功能，只需要在数据库中设计好表结构，就能一键生成前后端代码，是不是很nice，使用流程如下</p> <h4><a id="_1011"></a>表结构设计</h4> <ol> <li>配置主键（字符串或者整形皆可，整形可不设置自增）</li> <li>可以设计字段是否为空（会根据这个进行表单验证）</li> <li>设计注释，<code>前端会根据注释生成表格标题</code></li> </ol> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530232700.jpg" alt="20220530232700" /></p> <p>我们数据库中表都能在这看到，需根据自己的需求进行 <code>生成器配置</code></p> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530232258.jpg" alt="20220530232258" /></p> <h4><a id="_1023"></a>代码生成配置</h4> <p>首先点击编辑按钮</p> <h4><a id="_1027"></a>配置表字段信息</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530232354.jpg" alt="20220530232354" /></p> <ul> <li>列表：如果勾选会显示在前端的table中</li> <li>表单：如果勾选会显示在新增和编辑的form表单中</li> <li>日期注解：可以配置自动创建时间</li> <li>数据字段：一般用于单选、多选、下拉列表</li> </ul> <h4><a id="_1036"></a>配置生成器信息</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530232422.jpg" alt="20220530232422" /></p> <h4><a id="_1040"></a>生成代码</h4> <p>可以点击【保存&amp;生成】按钮生成代码</p> <h4><a id="_1044"></a>代码生成预览</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530232437.jpg" alt="20220530232437" /></p> <h4><a id="_1048"></a>代码生成打包下载</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530232455.jpg" alt="20220530232455" /></p> <h3><a id="_1052"></a>额外工作</h3> <p>代码生成可以节省你<code>80%</code>左右的开发任务，部分是需要自己需求进行修改的，如：</p> <ol> <li>添加菜单：虽然代码给你生成了，但是菜单还是需要自己手动添加的</li> <li>按钮权限：接口权限默认生成了，但是没有添加进数据库，需要自行添加，菜单管理中添加按钮</li> </ol> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0KKoFeJHfZAED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4UDAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5KJD6t7FkFdEvGUo1g7qJoG3MHImqRIn8nzY1K9UPKKiJmtnUqHVE3Gbuay6vJEN2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6IG5Eru4LHmPJZEQsrvPUbMiA8GWgMK7w7Iez7o2ANfbrjvaOl1tFMshtG3IrZH9hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5iy0UDK35LMxXisn9xQtKnd26gTIHsHeoblKb29fUmN8Y9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybuoeV8zFeYN3xx576Q6RHVmplE4ncQV5v5rzSoyOU7PuEAg8g803PwBJ0CExnojcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPvouCjz0MKUHz1J2E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vtMoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG2DOZIXgCYT8uMGZNe2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErPkFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4P2FGaJh8c7e9qgowQ7cGBo98WsLkuktFqiZabtXuQTuY5ETbR0v7tNSFnvrmu6pjdoan2KjMu8qHmj1EfCO2ZGfEIbIXKUlw8qaX9b2oeSJmFksSeTFn0V3nSypChh4Gjh74ybO9aeZAN2dwciu2MhAAAAAElFTkSuQmCC_1059"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC" alt="img" />运维管理</h3> <h4><a id="_1061"></a>运维管理</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530232842.jpg" alt="20220530232842" /></p> <h4><a id="_1065"></a>新增服务器</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530232902.jpg" alt="20220530232902" /></p> <h4><a id="_1069"></a>新增应用</h4> <p>这里用 <code>eladmin-monitor-2.4.jar</code> 来举例，设置应用名称与目录，然后编写脚本即可</p> <p><img src="https://eladmin.vip/images/2022/20220530232917.jpg" alt="img" /></p> <p>部署脚本</p> <pre><div class="hljs"><code class="lang-shell">mv -f /opt/upload/eladmin-monitor-2.4.jar /opt/monitor cd /opt/monitor nohup java -jar eladmin-monitor-2.4.jar &gt;nohup.out 2&gt;&amp;1 &amp; </code></div></pre> <p>启动脚本</p> <pre><div class="hljs"><code class="lang-shell">cd /opt/monitor nohup java -jar eladmin-monitor-2.4.jar &gt;nohup.out 2&gt;&amp;1 &amp; </code></div></pre> <h4><a id="_1092"></a>部署应用</h4> <p>打开部署管理菜单，新建一个部署</p> <p>点击一键部署按钮，上传<img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530233006.jpg" alt="20220530233006" />应用文件, 上传后系统就会自动部署了</p> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530233021.jpg" alt="20220530233021" /></p> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530233038.jpg" alt="20220530233038" /></p> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530233103.jpg" alt="20220530233103" /></p> <h4><a id="_1104"></a>管理应用</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530233118.jpg" alt="20220530233118" /></p> <h4><a id="_1108"></a>数据库管理</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530233132.jpg" alt="20220530233132" /></p> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20220530233200.jpg" alt="20220530233200" /></p> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5DxFJaTYItIuK2Kr3BJNwkxBj05sQY3b3nM6cs2dv9t7NTvQJwsndk5MPNzJkzewGerPpAmyON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdWi781o1VVlm410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi7O9iXFT6MswI0DmmpkSaJ0qLxFIm3i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUVMnSawNNAUqpT3ClJWg5I3BLTcGWDXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSxuRQixfmq7rK0wYD8w8E905bnPDfwoWsrfv93NWNZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGWZEl945dTP34wlR2FZVQWU1q0Cw8Tr7phgLLNL0FPxxQ35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UHk0lfyrsBKdPVvAriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1uKBbyVPGkN3ZAeC6hr0x7Nr38N5EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOBYHi6QTrChDIWDBRi5U5fZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwIhnmcAZ91isYMJIaCUCx9W098LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7kOjIGxeNEkomyLVta0xxnHZhjBc4YZAFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j14dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6JDjq6p3OxyO2cB4Car7vo3GXgfAkj23x9ID1TeoamoSXcbvSf2PX7Vc8DdCmE1vN9di32P95YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7jctrJpsP4COhDIl0La2FS45mlocBaXY5QnGZysIBYoeSsl5qQzrSjcgNrfuEzlWBfwAEjrZyWUvpAAAAABJRU5ErkJggg_1114"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==" alt="img" />系统工具</h3> <h4><a id="_1116"></a>系统工具</h4> <p>为了让大家快速的熟悉该项目，这里列举出项目中使用到的工具类</p> <ul> <li>ElAdminConstant：系统常用常量定义</li> <li>EncryptUtils：加密工具，包括对称加密解密，md5加盐加密</li> <li>FileUtil：文件工具类</li> <li>PageUtil：分页工具类</li> <li>RequestHolder：随时获取 HttpServletRequest</li> <li>SecurityUtils：获取当前用户</li> <li>SpringContextHolder：随时获取bean</li> <li>StringUtils：字符串工具类</li> <li>ThrowableUtil：异常工具，获取堆栈信息</li> <li>ValidationUtil：验证工具</li> <li>RsaUtils：可生成公钥私钥，加密解密功能</li> </ul> <h4><a id="_1132"></a>目录如下</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20200605160509.jpg" alt="20200605160509" /></p> <h3><a id="imgdataimagepngbase64iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0KKoFeJHfZAED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4UDAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5KJD6t7FkFdEvGUo1g7qJoG3MHImqRIn8nzY1K9UPKKiJmtnUqHVE3Gbuay6vJEN2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6IG5Eru4LHmPJZEQsrvPUbMiA8GWgMK7w7Iez7o2ANfbrjvaOl1tFMshtG3IrZH9hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5iy0UDK35LMxXisn9xQtKnd26gTIHsHeoblKb29fUmN8Y9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybuoeV8zFeYN3xx576Q6RHVmplE4ncQV5v5rzSoyOU7PuEAg8g803PwBJ0CExnojcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPvouCjz0MKUHz1J2E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vtMoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG2DOZIXgCYT8uMGZNe2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErPkFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4P2FGaJh8c7e9qgowQ7cGBo98WsLkuktFqiZabtXuQTuY5ETbR0v7tNSFnvrmu6pjdoan2KjMu8qHmj1EfCO2ZGfEIbIXKUlw8qaX9b2oeSJmFksSeTFn0V3nSypChh4Gjh74ybO9aeZAN2dwciu2MhAAAAAElFTkSuQmCC_1136"></a><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC" alt="img" />其他杂项</h3> <h4><a id="_1138"></a>系统基类</h4> <p>2.3 版本加入了 Entity 基类 和 DTO 基类，大家可以按需去继承和修改，代码路径</p> <pre><div class="hljs"><code class="lang-text">eladmin-common -&gt; me.zhengjie.base </code></div></pre> <h4><a id="_1147"></a>服务监控</h4> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20200605155951.jpg" alt="20200605155951" /></p> <p><img src="D:%5Ctest%5CgxlyeduV2-cloud-0.1%5Cscript%5Cimg%5C20200605160022.jpg" alt="20200605160022" /></p> <h4><a id="_1155"></a>异步线程池</h4> <p>该版本重写了spring默认线程池，代码地址：</p> <pre><div class="hljs"><code class="lang-text">eladmin-system -&gt; me.zhengjie.config.AsyncTaskExecutePool </code></div></pre> <p>源码如下：</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-meta">@Slf4j</span> <span class="hljs-meta">@Configuration</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncTaskExecutePool</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AsyncConfigurer</span> { <span class="hljs-comment">//注入配置类</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AsyncTaskProperties config; <span class="hljs-keyword">public</span> <span class="hljs-title function_">AsyncTaskExecutePool</span><span class="hljs-params">(AsyncTaskProperties config)</span> { <span class="hljs-built_in">this</span>.config = config; } <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">getAsyncExecutor</span><span class="hljs-params">()</span> { <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>(); <span class="hljs-comment">//核心线程池大小</span> executor.setCorePoolSize(config.getCorePoolSize()); <span class="hljs-comment">//最大线程数</span> executor.setMaxPoolSize(config.getMaxPoolSize()); <span class="hljs-comment">//队列容量</span> executor.setQueueCapacity(config.getQueueCapacity()); <span class="hljs-comment">//活跃时间</span> executor.setKeepAliveSeconds(config.getKeepAliveSeconds()); <span class="hljs-comment">//线程名字前缀</span> executor.setThreadNamePrefix(<span class="hljs-string">&quot;el-async-&quot;</span>); <span class="hljs-comment">// setRejectedExecutionHandler：当pool已经达到max size的时候，如何处理新任务</span> <span class="hljs-comment">// CallerRunsPolicy：不在新线程中执行任务，而是由调用者所在的线程来执行</span> executor.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()); executor.initialize(); <span class="hljs-keyword">return</span> executor; } <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> AsyncUncaughtExceptionHandler <span class="hljs-title function_">getAsyncUncaughtExceptionHandler</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> (throwable, method, objects) -&gt; { log.error(<span class="hljs-string">&quot;====&quot;</span>+throwable.getMessage()+<span class="hljs-string">&quot;====&quot;</span>, throwable); log.error(<span class="hljs-string">&quot;exception method:&quot;</span>+method.getName()); }; } } </code></div></pre> <p>使用方式如下</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-comment">// 在 service 的方法上使用注解</span> <span class="hljs-meta">@Async</span> </code></div></pre> <h4><a id="_1215"></a>线程池工具类</h4> <p>通过该工具类可以快速创建一个线程池，目前在 定时任务模块中使用到 ，代码地址：</p> <pre><div class="hljs"><code class="lang-text">eladmin-system -&gt; me.zhengjie.config.ThreadPoolExecutorUtil </code></div></pre> <p>源码如下：</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-comment">/** * 用于获取自定义线程池 * <span class="hljs-doctag">@author</span> Zheng Jie * <span class="hljs-doctag">@date</span> 2019年10月31日18:16:47 */</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExecutorUtil</span> { <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ThreadPoolExecutor <span class="hljs-title function_">getPoll</span><span class="hljs-params">()</span>{ <span class="hljs-type">AsyncTaskProperties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> SpringContextHolder.getBean(AsyncTaskProperties.class); <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>( properties.getCorePoolSize(), properties.getMaxPoolSize(), properties.getKeepAliveSeconds(), TimeUnit.SECONDS, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(properties.getQueueCapacity()), <span class="hljs-keyword">new</span> <span class="hljs-title class_">TheadFactoryName</span>() ); } } </code></div></pre> <p>使用方式：</p> <pre><div class="hljs"><code class="lang-java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> ThreadPoolExecutorUtil.getPoll(); </code></div></pre>